<html>
  <head>
    <title>Successfully authorization to zendesk</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  </head>

  <body>
    <p id="error"></p>
    <p id="token"></p>
    <p id="scope"></p>

    <p> Test requests </p>
    <button id="read">READ</button>
    <button id="write">WRITE</button>


    <p id="response" style="display: none;">
      <span style="float: left; margin-right: 10px;">Response:</span>
      <p id="response_area" style="width: 500px; height:200px;"></p>
    </p>

    <img id="spinner" src="https://raw.github.com/sjhcockrell/spinners/master/gif/spinner_16.gif" style="display:none;" />

    <script type="text/javascript">
      // http://stackoverflow.com/questions/1403888/get-url-parameter-with-jquery
      function getHashParameter(name) {
        return decodeURIComponent((new RegExp('[#|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.hash)||[,""])[1].replace(/\+/g, '%20'))||null;
      }

      function accessToken() {
        return getHashParameter("access_token");
      }

      function tokenScope() {
        return getHashParameter("scope");
      }

      function makeRequest(url, method) {
        var spinner = $("#spinner");
        spinner.show();

        $.ajax(url, {
          method: method,
          beforeSend: function(xhr) {
            xhr.setRequestHeader("Authorization", "Bearer " + accessToken());
          }
        }).done(function(data, textStatus, xhr) {
          $("#response_area").html(JSON.stringify(data));
          $("#response").show()
        }).fail(function(xhr, textStatus, errorThrown) {
          console.log(xhr);
          console.log(textStatus);
          console.log(errorThrown);

          $("#response_area").html("An error occured, check the console.");
          $("#response").show()
        }).complete(function() {
          spinner.hide();
          $("#authorize").show();
        });
      }


      $(document).ready(function() {
        var error = getHashParameter("error");

        if(error) {
          $("#error").html(getHashParameter("error_description"));
//            $("#authorize").show();
        } else if(token) {
          $("#token").html("Token: " + accessToken());
          $("#scope").html("Scope: " + tokenScope());
        }

        $('#read').click(function () {
          makeRequest('https://dev.zd-dev.com/api/v2/tickets.json', 'GET');
        });
      });
    </script>
  </body>
</html>
